name: 'Build docs'
description: 'Build documentation'

inputs:
  type:
    required: true,
  version:
    required: true,

runs:
  using: "composite"
  steps:
  - name: Deploy ðŸš€
    uses: JamesIves/github-pages-deploy-action@v4
    if: ${{ inputs.type == 'dev' }}
    with:
      single-commit: true
      branch: gh-pages
      folder: _build/html
      clean: true
      target-folder: /version/dev/

  - name: Deploy (version) ðŸš€
    uses: JamesIves/github-pages-deploy-action@v4
    if: ${{ inputs.type == 'stable' }}
    with:
      single-commit: true
      branch: gh-pages
      folder: _build/html
      clean: true
      target-folder: /version/${{ inputs.version }}/

  - name: Fetch JSON and Get Preferred Version
    shell: bash
    run: |
      #JSON=$(cat ${GITHUB_WORKSPACE}/docs/_static/versions.json)
      JSON=$(curl -s "https://raw.githubusercontent.com/scverse/SnapATAC2/main/docs/_static/versions.json")
      VERSION=$(echo "$JSON" | jq -r '.[] | select(.preferred == true) | .version')
      echo "PREFERRED_VERSION=$VERSION" >> $GITHUB_ENV
      echo "Preferred version is $VERSION"

  - name: Checkout code from gh-pages branch into folder
    uses: actions/checkout@v5
    with:
      ref: 'gh-pages'
      path: 'gh-pages-folder'

  - name: Deploy (preferred version)
    uses: JamesIves/github-pages-deploy-action@v4
    with:
      single-commit: true
      branch: gh-pages
      folder: gh-pages-folder/version/${{ env.PREFERRED_VERSION }}
      clean: true
      clean-exclude: version